<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Heatmap Example</title>
    <!-- Google Maps JavaScript API -->

    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB70UUwpU9dSy_nShI4v2eMeL8oSI9j-aM&libraries=visualization&callback=initMap"
    ></script>

    <style>
      /* Stylizacja mapy, pełny widok */
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
      function initMap() {
        const mapDiv = document.getElementById("map");
        if (!mapDiv) {
          console.error("Element mapy nie został znaleziony.");
          return;
        }

        const options = {
          zoom: 13,
          center: { lat: 42.0, lng: -87.96 }, // Przykładowe centrum mapy
          mapTypeId: "satellite",
        };

        const map = new google.maps.Map(mapDiv, options);

        fetch("/heatmap-data")
          .then((response) => response.json())
          .then((data) => {
            // Sprawdzanie, czy dane są tablicą
            if (!Array.isArray(data)) {
              throw new Error("Otrzymane dane nie są tablicą");
            }

            // Tworzenie obiektów LatLng z danymi
            const heatmapData = data.map((item) => {
              if (item.location) {
                return {
                  location: new google.maps.LatLng(
                    item.location.lat,
                    item.location.lng
                  ),
                  weight: item.weight || 1,
                };
              }
              throw new Error("Brak właściwości location w danych.");
            });

            const heatmap = new google.maps.visualization.HeatmapLayer({
              data: heatmapData,
              map: map,
            });

            heatmap.setMap(map);
          })
          .catch((error) =>
            console.error("Error loading heatmap data:", error)
          );
      }
    </script>
  </body>
</html>
